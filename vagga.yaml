containers:
  xenial:
    setup:
    - !Ubuntu xenial
    - !Install [apt-transport-https, ca-certificates]

  bulk:
    setup:
    - !Alpine v3.6
    - !Install [vim] # edit tag text
    - &bulk !Tar
      url: "https://github.com/tailhook/bulk/releases/download/v0.4.9/bulk-v0.4.9.tar.gz"
      sha256: 23471a9986274bb4b7098c03e2eb7e1204171869b72c45385fcee1c64db2d111
      path: /

commands:

  _package-xenial: !Command
    description: Make package for ubuntu xenial
    container: bulk
    run:
    - bulk
    - pack
    - --dir=ubuntu-xenial
    - --dest-dir=dist

  bulk: !Command
    description: Run any `bulk` command
    container: bulk
    run: [bulk]

  test-xenial: !Command
    write-mode: transient-hard-link-copy
    container: xenial
    prerequisites: [_package-xenial]
    run: |
      set -ex
      cat mintaka-ubuntu-xenial.list > /etc/apt/sources.list.d/mintaka.list
      apt-get update
      dpkg -i dist/mintaka-*.deb || apt-get install -fy
      lithos_tree --version
      cantal-agent --version
      verwalter --version
      ciruela-server --version
      swindon --version
      bash
